from math import floor

import matplotlib.pyplot as plt

plt.rcParams.update(
    {
        "font.size": 20,
        "font.family": "Fira Code",
    }
)

title = ""
x_label = "Vantage Point IP Address"
y_label = "Server Cluster ID"
z_label = "[Percentage] (%)"
z_min, z_max = 0, 100
x_ticks = [
    "5.180.61.148",
    "5.180.61.150",
    "5.180.61.151",
    "5.180.61.155",
    "5.180.61.180",
    "5.180.61.184",
    "5.180.61.185",
    "5.180.62.226",
    "5.180.209.104",
    "5.180.209.106",
    "5.180.209.107",
    "5.180.209.241",
    "5.180.209.242",
    "5.180.209.247",
    "5.253.115.141",
    "5.253.115.142",
    "5.253.115.144",
    "159.48.53.17",
    "159.48.53.166",
    "159.48.53.167",
    "159.48.53.168",
    "159.48.53.170",
    "165.231.67.24",
    "165.231.67.25",
    "165.231.67.28",
    "165.231.67.31",
    "165.231.67.32",
    "165.231.67.34",
    "194.233.96.74",
    "194.233.96.76",
    "194.233.96.77",
    "194.233.96.78",
    "194.233.96.102",
    "194.233.96.104",
    "196.240.57.212",
    "196.240.57.214",
]
y_ticks = ["lhr03", "lhr08", "cdg02", "mrs02", "ams02", "mil02", "fra06"]
table = [
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        66.66666667,
        44.18604651,
        48.98758981,
        50.22727273,
        50.57034221,
        51.94805195,
        0,
        0,
        0,
        0,
        0,
        0,
        54.20168067,
        48.93882647,
    ],
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        19.23583663,
        20.32967033,
        18.64801865,
        16.82847896,
        20.42093288,
        20.6302521,
        16.76750216,
        18.97533207,
        20.84188912,
        20.67782068,
        20.45039562,
        19.35110081,
        21.73913043,
        20,
        20.23460411,
        33.33333333,
        55.81395349,
        51.01241019,
        49.77272727,
        49.42965779,
        48.05194805,
        0,
        0,
        0,
        0,
        0,
        0,
        45.79831933,
        51.06117353,
    ],
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        20.9486166,
        19.50549451,
        22.14452214,
        18.60841424,
        20.76222981,
        19.07563025,
        21.60760588,
        21.37887413,
        18.99383984,
        19.69111969,
        19.47656726,
        19.52491309,
        20.57971014,
        18.03278689,
        20.82111437,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ],
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        18.05006588,
        18.13186813,
        21.79487179,
        20.38834951,
        20.02275313,
        19.74789916,
        21.6940363,
        20.55660974,
        20.12320329,
        19.17631918,
        20.14607425,
        20.1622248,
        14.7826087,
        20.49180328,
        18.76832845,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ],
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        20.8168643,
        21.42857143,
        19.6969697,
        20.55016181,
        18.31626849,
        19.78991597,
        20.82973207,
        18.91208096,
        21.56057495,
        22.00772201,
        20.54169203,
        20.39397451,
        20.86956522,
        20.49180328,
        21.17302053,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ],
    [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0.06325110689,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
    ],
    [
        100,
        100,
        100,
        100,
        100,
        100,
        100,
        20.9486166,
        20.6043956,
        17.71561772,
        23.62459547,
        20.4778157,
        20.75630252,
        19.1011236,
        20.11385199,
        18.48049281,
        18.44701845,
        19.38527085,
        20.56778679,
        22.02898551,
        20.98360656,
        19.00293255,
        0,
        0,
        0,
        0,
        0,
        0,
        100,
        100,
        100,
        100,
        100,
        100,
        0,
        0,
    ],
]


fig, ax = plt.subplots(figsize=(30, 10))

im = ax.imshow(table, vmin=z_min, vmax=z_max, cmap="viridis")

ax.set_title(title)
ax.set_xlabel(x_label, labelpad=10.0)
ax.xaxis.set_label_position("top")
ax.tick_params(top=True, labeltop=True, bottom=False, labelbottom=False)
ax.set_ylabel(y_label)
cbar = ax.figure.colorbar(
    im,
    ticks=[z_min, z_max],
    shrink=0.49,
    # label=z_label,
    pad=0.01,
)
cbar.ax.set_yticklabels([z_min, z_max])
cbar.ax.text(2.3, 15, z_label, rotation=90)

ax.set_xticks(range(len(x_ticks)), labels=x_ticks, rotation=90)
ax.set_yticks(range(len(y_ticks)), labels=y_ticks)

for i in range(len(y_ticks)):
    for j in range(len(x_ticks)):
        if table[i][j] == 0:
            continue
        text = f"{floor(table[i][j]):.0f}"
        if text == "0":
            text = "<1"
        textcolor = "w"
        if table[i][j] * 2 > z_min + z_max:
            textcolor = "k"
        ax.text(j, i, text, ha="center", va="center", color=textcolor)

ax.spines[:].set_visible(False)

plt.savefig(f"heatmap-vp-ip-cluster_k1006.png", bbox_inches="tight")
plt.close(fig)
